<div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-12">
    <div class="flex flex-col md:flex-row items-start md:items-center justify-between mb-8 gap-4 animate-fade-in-up">
        <div>
            <h1 class="text-3xl md:text-4xl font-bold mb-2">Editor de Landing Page</h1>
            <p class="text-base md:text-lg opacity-70">Personaliza los textos e im√°genes de tu p√°gina principal en tiempo real</p>
        </div>
    </div>

    @if (settings) {
    <form (ngSubmit)="saveSettings()" class="space-y-12 animate-fade-in-up" novalidate>
        
        <!-- Bloque 1: Pantalla Principal (Hero) -->
        <div class="card bg-base-100 shadow-xl border border-base-300">
            <div class="card-body">
                <h2 class="card-title text-2xl border-b border-base-300 pb-4 mb-4">1. Bienvenida (Hero)</h2>
                
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div class="flex flex-col gap-2 w-full">
                        <label class="form-control w-full">
                            <div class="label"><span class="label-text font-bold text-lg">T√≠tulo Principal</span></div>
                            <input type="text" [(ngModel)]="settings.heroTitle" name="heroTitle" required
                                   class="input input-bordered w-full focus:input-primary font-cursive text-2xl" placeholder="Ej. Contempla">
                        </label>
                        <div class="flex flex-col sm:flex-row gap-6 mt-4">
                            <div class="flex flex-col justify-center gap-2">
                                <label class="flex items-center gap-2 cursor-pointer">
                                    <span class="text-sm font-bold opacity-70">Color</span>
                                    <input type="color" [(ngModel)]="settings.heroTitleColor" name="heroTitleColor" class="w-8 h-8 rounded cursor-pointer border-0 p-0">
                                </label>
                            </div>
                            <div class="flex-1 flex flex-col justify-center">
                                <span class="text-xs font-bold opacity-70 mb-2">Tama√±o del Texto</span>
                                <input type="range" min="0" max="6" [value]="getSizeIndex(settings.heroTitleSize)" (input)="setSizeFromIndex($event, 'heroTitleSize')" class="range range-xs range-primary" step="1" />
                                <div class="w-full flex justify-between text-[10px] px-1 mt-1 opacity-50 font-bold">
                                    <span>XS</span><span>SM</span><span>MD</span><span>LG</span><span>XL</span><span>2X</span><span>3X</span>
                                </div>
                            </div>
                            <div class="w-24 h-16 border border-base-300 rounded-xl bg-base-200 flex items-center justify-center overflow-hidden flex-shrink-0 shadow-inner">
                                <span [ngClass]="settings.heroTitleSize" [style.color]="settings.heroTitleColor" class="font-cursive leading-none">Aa</span>
                            </div>
                        </div>
                    </div>

                    <div class="flex flex-col gap-2 w-full">
                        <label class="form-control w-full">
                            <div class="label"><span class="label-text font-bold text-lg">Subt√≠tulo Corto</span></div>
                            <input type="text" [(ngModel)]="settings.heroSubtitle" name="heroSubtitle" required
                                   class="input input-bordered w-full focus:input-primary" placeholder="Ej. El Arte del Caf√©">
                        </label>
                        <div class="flex flex-col sm:flex-row gap-6 mt-4">
                            <div class="flex flex-col justify-center gap-2">
                                <label class="flex items-center gap-2 cursor-pointer">
                                    <span class="text-sm font-bold opacity-70">Color</span>
                                    <input type="color" [(ngModel)]="settings.heroSubtitleColor" name="heroSubtitleColor" class="w-8 h-8 rounded cursor-pointer border-0 p-0">
                                </label>
                            </div>
                            <div class="flex-1 flex flex-col justify-center">
                                <span class="text-xs font-bold opacity-70 mb-2">Tama√±o del Texto</span>
                                <input type="range" min="0" max="6" [value]="getSizeIndex(settings.heroSubtitleSize)" (input)="setSizeFromIndex($event, 'heroSubtitleSize')" class="range range-xs range-primary" step="1" />
                                <div class="w-full flex justify-between text-[10px] px-1 mt-1 opacity-50 font-bold">
                                    <span>XS</span><span>SM</span><span>MD</span><span>LG</span><span>XL</span><span>2X</span><span>3X</span>
                                </div>
                            </div>
                            <div class="w-24 h-16 border border-base-300 rounded-xl bg-base-200 flex items-center justify-center overflow-hidden flex-shrink-0 shadow-inner">
                                <span [ngClass]="settings.heroSubtitleSize" [style.color]="settings.heroSubtitleColor" class="leading-none uppercase tracking-widest font-light">Aa</span>
                            </div>
                        </div>
                    </div>
                </div>

                <label class="form-control w-full mt-4">
                    <div class="label"><span class="label-text font-bold">Fondo de Pantalla Principal (Hero)</span></div>
                    <div class="flex flex-col md:flex-row gap-4 items-center">
                        <div class="w-full md:w-2/3 relative">
                            <!-- Custom File Input to display Spanish text -->
                            <input type="file" id="heroBgInput" (change)="onFileSelected($event, 'heroBg')" accept="image/*" class="absolute inset-0 w-full h-full opacity-0 cursor-pointer z-10" />
                            <div class="flex items-center gap-2">
                                <button type="button" class="btn btn-neutral pointer-events-none">Elegir Archivo</button>
                                <span class="opacity-70 text-sm italic pointer-events-none">Ning√∫n archivo seleccionado</span>
                            </div>
                            <div class="text-[11px] opacity-60 mt-2 font-medium">üí° Recomendado: 1920x1080px (Alta calidad, horizontal)</div>
                        </div>
                        <div class="w-full md:w-1/3 flex justify-center">
                            @if (settings.heroBgUrl) {
                                <div class="avatar">
                                    <div class="w-32 rounded-lg border-2 border-primary shadow-lg">
                                        <img [src]="settings.heroBgUrl" alt="Fondo Hero" class="cursor-pointer hover:opacity-80 transition-opacity w-full h-full object-cover" title="Ver tama√±o completo" (click)="openImagePreview(settings.heroBgUrl); $event.preventDefault(); $event.stopPropagation()">
                                    </div>
                                </div>
                            }
                        </div>
                    </div>
                </label>
            </div>
        </div>

        <!-- Bloque 2: Nuestra Esencia -->
        <div class="card bg-base-100 shadow-xl border border-base-300">
            <div class="card-body">
                <h2 class="card-title text-2xl border-b border-base-300 pb-4 mb-4">2. Nuestra Esencia</h2>
                
                <div class="flex flex-col gap-2 w-full mb-4">
                    <label class="form-control w-full">
                        <div class="label"><span class="label-text font-bold text-lg">Encabezado de Secci√≥n</span></div>
                        <input type="text" [(ngModel)]="settings.aboutTitle" name="aboutTitle" required
                               class="input input-bordered w-full focus:input-primary max-w-md" placeholder="Ej. Nuestra Esencia">
                    </label>
                    <div class="flex flex-col sm:flex-row gap-6 mt-4">
                        <div class="flex flex-col justify-center gap-2">
                            <label class="flex items-center gap-2 cursor-pointer">
                                <span class="text-sm font-bold opacity-70">Color</span>
                                <input type="color" [(ngModel)]="settings.aboutTitleColor" name="aboutTitleColor" class="w-8 h-8 rounded cursor-pointer border-0 p-0">
                            </label>
                        </div>
                        <div class="flex-1 flex flex-col justify-center">
                            <span class="text-xs font-bold opacity-70 mb-2">Tama√±o del Texto</span>
                            <input type="range" min="0" max="6" [value]="getSizeIndex(settings.aboutTitleSize)" (input)="setSizeFromIndex($event, 'aboutTitleSize')" class="range range-xs range-primary" step="1" />
                            <div class="w-full flex justify-between text-[10px] px-1 mt-1 opacity-50 font-bold">
                                <span>XS</span><span>SM</span><span>MD</span><span>LG</span><span>XL</span><span>2X</span><span>3X</span>
                            </div>
                        </div>
                        <div class="w-24 h-16 border border-base-300 rounded-xl bg-base-200 flex items-center justify-center overflow-hidden flex-shrink-0 shadow-inner">
                            <span [ngClass]="settings.aboutTitleSize" [style.color]="settings.aboutTitleColor" class="font-bold leading-none">Aa</span>
                        </div>
                    </div>
                </div>

                <div class="flex flex-col gap-4 mb-4">
                    <div class="flex items-center gap-2">
                        <label class="flex items-center gap-2 cursor-pointer mt-2">
                            <span class="text-sm font-bold opacity-70">Color de Textos Largos</span>
                            <input type="color" [(ngModel)]="settings.aboutTextColor" name="aboutTextColor" class="w-8 h-8 rounded cursor-pointer border-0 p-0">
                        </label>
                    </div>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <label class="form-control w-full">
                            <div class="label"><span class="label-text font-bold">P√°rrafo 1</span></div>
                            <textarea [(ngModel)]="settings.aboutText1" name="aboutText1" rows="4" required
                                      class="textarea textarea-bordered focus:textarea-primary text-base leading-relaxed"></textarea>
                        </label>
    
                        <label class="form-control w-full">
                            <div class="label"><span class="label-text font-bold">P√°rrafo 2</span></div>
                            <textarea [(ngModel)]="settings.aboutText2" name="aboutText2" rows="4" required
                                      class="textarea textarea-bordered focus:textarea-primary text-base leading-relaxed"></textarea>
                        </label>
                    </div>
                </div>

                <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                    <label class="form-control w-full border border-base-200 p-4 rounded-xl">
                        <div class="label"><span class="label-text font-bold">Imagen de Acompa√±amiento</span></div>
                        <div class="relative w-full mb-4">
                            <input type="file" (change)="onFileSelected($event, 'aboutImage')" accept="image/*" class="absolute inset-0 w-full h-full opacity-0 cursor-pointer z-10" />
                            <div class="flex flex-col gap-2">
                                <button type="button" class="btn btn-neutral btn-sm pointer-events-none">Elegir Archivo</button>
                                <span class="opacity-70 text-xs italic pointer-events-none">Ning√∫n archivo seleccionado</span>
                            </div>
                            <div class="text-[11px] opacity-60 mt-2 font-medium">üí° Recomendado: 800x800px (Cuadrada)</div>
                        </div>
                        @if (settings.aboutImage1) { <img [src]="settings.aboutImage1" class="w-full h-32 object-cover rounded-md shadow cursor-pointer hover:opacity-80 transition-opacity" title="Ver tama√±o completo" (click)="openImagePreview(settings.aboutImage1); $event.preventDefault(); $event.stopPropagation()"> }
                    </label>

                    <label class="form-control w-full border border-base-200 p-4 rounded-xl">
                        <div class="label"><span class="label-text font-bold">Fondo de la Secci√≥n (Esencia)</span></div>
                        <div class="relative w-full mb-4">
                            <input type="file" (change)="onFileSelected($event, 'aboutBg')" accept="image/*" class="absolute inset-0 w-full h-full opacity-0 cursor-pointer z-10" />
                            <div class="flex flex-col gap-2">
                                <button type="button" class="btn btn-neutral btn-sm pointer-events-none">Elegir Archivo</button>
                                <span class="opacity-70 text-xs italic pointer-events-none">Ning√∫n archivo seleccionado</span>
                            </div>
                            <div class="text-[11px] opacity-60 mt-2 font-medium">üí° Recomendado: 1920x1080px (Patr√≥n o textura)</div>
                        </div>
                        @if (settings.aboutBgUrl) { <img [src]="settings.aboutBgUrl" class="w-full h-32 object-cover rounded-md shadow cursor-pointer hover:opacity-80 transition-opacity" title="Ver tama√±o completo" (click)="openImagePreview(settings.aboutBgUrl); $event.preventDefault(); $event.stopPropagation()"> }
                    </label>
                </div>
            </div>
        </div>

        <!-- Bloque 3: Men√∫ P√∫blico -->
        <div class="card bg-base-100 shadow-xl border border-base-300">
            <div class="card-body">
                <h2 class="card-title text-2xl border-b border-base-300 pb-4 mb-4">3. Visor de Men√∫ P√∫blico</h2>
                
                <p class="opacity-80 mb-4">Esta es la imagen de fondo que aparece detr√°s de la lista de tus bebidas y platillos en la parte final de la Landing Page.</p>
                <label class="form-control w-full max-w-lg">
                    <div class="label"><span class="label-text font-bold">Imagen de Fondo para Men√∫</span></div>
                    <div class="relative w-full mb-4 mt-2">
                        <input type="file" (change)="onFileSelected($event, 'menuBg')" accept="image/*" class="absolute inset-0 w-full h-full opacity-0 cursor-pointer z-10" />
                        <div class="flex items-center gap-2">
                            <button type="button" class="btn btn-neutral btn-sm pointer-events-none">Elegir Archivo</button>
                            <span class="opacity-70 text-sm italic pointer-events-none">Ning√∫n archivo seleccionado</span>
                        </div>
                        <div class="text-[11px] opacity-60 mt-2 font-medium">üí° Recomendado: 1920x1080px (Fondo horizontal)</div>
                    </div>
                    @if (settings.menuBgUrl) { <img [src]="settings.menuBgUrl" class="w-full h-40 object-cover rounded-xl shadow border-2 border-base-200 cursor-pointer hover:opacity-80 transition-opacity" title="Ver tama√±o completo" (click)="openImagePreview(settings.menuBgUrl); $event.preventDefault(); $event.stopPropagation()"> }
                </label>
            </div>
        </div>

        <!-- Bot√≥n de Guardado Flotante (Scrolling) -->
        <div class="fixed bottom-6 right-6 z-50 animate-fade-in-up">
            <button type="submit" [disabled]="isSaving" class="btn btn-primary btn-circle btn-lg h-16 w-16 md:h-20 md:w-20 shadow-2xl hover:scale-105 transition-transform border-4 border-base-100" title="Guardar Cambios">
                @if (isSaving) {
                    <span class="loading loading-spinner loading-lg"></span>
                } @else {
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8 md:h-10 md:w-10" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" /></svg>
                }
            </button>
        </div>
    </form>
    } @else {
        <div class="flex justify-center items-center h-64">
            <span class="loading loading-spinner loading-lg text-primary"></span>
        </div>
    }
</div>

<!-- Image Preview Modal / Lightbox -->
<dialog class="modal z-[100]" [class.modal-open]="showImagePreview">
    <div class="modal-box bg-transparent shadow-none p-0 overflow-visible max-w-4xl relative flex justify-center items-center h-full">
        <button class="btn btn-sm btn-circle btn-ghost absolute right-2 top-2 lg:-right-12 lg:top-0 text-white bg-black/60 hover:bg-black/90 z-50 text-xl" 
                (click)="closeImagePreview()">‚úï</button>
        @if (previewImageUrl) {
            <img [src]="previewImageUrl" class="object-contain max-h-[85vh] w-auto max-w-full rounded-2xl shadow-2xl scale-100 animate-zoom-in" alt="Vista Previa">
        }
    </div>
    <!-- Clickeo afuera cierra el modal -->
    <form method="dialog" class="modal-backdrop bg-black/80 backdrop-blur-sm" (click)="closeImagePreview()">
        <button>cerrar</button>
    </form>
</dialog>

<!-- Toast Notification -->
@if (toastMessage) {
    <div class="toast toast-end toast-bottom z-50 animate-fade-in-up">
        <div class="alert alert-success bg-success text-success-content shadow-lg max-w-sm rounded-box border-none">
            <svg xmlns="http://www.w3.org/2000/svg" class="stroke-current shrink-0 h-6 w-6" fill="none" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" /></svg>
            <span class="font-bold whitespace-normal">{{ toastMessage }}</span>
        </div>
    </div>
}


